USE GPAS_SSISMgmt_Dvlp

SELECT PackageLog.PackageLogID,
		MachineName,
		PackageLog.PackageName,
		PackageLog.PackageStartTime,
		PackageLog.PackageEndTime,
		ControlName,
       MIN(Task_Start_Time) as 'Tasks Started',
       MAX(Task_End_Time) as 'Tasks Finished',
       DATEPART(ss, MAX(Task_End_Time) - MIN(Task_Start_Time)) as 'Running Time', 
       SUM(DATEPART(ss, Task_Execution_Time)) as 'Execution Seconds',
       SUM([Rows]) as 'Total Row Count',
		SUM(PackageTaskLog.TotalErrorCount) as 'Total Error Count',
		SUM(PackageTaskLog.TotalWarningCount) as 'Total Warning Count'
FROM   PackageStatistics
       LEFT OUTER JOIN PackageTaskLog
                    ON PackageTaskLog.ControlName = PackageStatistics.TaskName
                   AND PackageTaskLog.PackageLogID = PackageStatistics.PackageLogID
        LEFT OUTER JOIN PackageLog
        ON PackageStatistics.PackageLogID = PackageLog.PackageLogID
WHERE  PackageStatistics.PackageLogID >= (SELECT Max(PackageLogID) - 7
                                      FROM   PackageLog)
        AND  (MachineName = 'VMPSSISDBD01' or PackageLog.UserName = 'CMUTUAL\nah4506')
GROUP BY PackageLog.PackageLogID, PackageLog.MachineName, PackageLog.PackageName, ControlName, PackageLog.PackageStartTime,
		PackageLog.PackageEndTime
ORDER BY PackageLogID DESC;