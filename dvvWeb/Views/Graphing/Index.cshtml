@model dvvWeb.Models.ConfigModel


@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    ViewBag.Title = "Graphing";
}

<h2>Graphing</h2>


    <div id="visualization"></div>


@section Scripts {
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.--> 
<script>
    var container = document.getElementById('visualization');
    var i = 1;
    var dataset = new vis.DataSet();
    var options = {
        start: moment(),
        end: moment() + 360000
    };
    var Graph2d = new vis.Graph2d(container, dataset, options);


        $(function () {
            // Reference the auto-generated proxy for the hub.  
            var chart = $.connection.chartHub;

            // Create a function that the hub can call back to display messages.
            chart.client.addPointToChart = function (point) {
                var now = moment();
                var newData = [];
                newData.push({x: now, y: point });
                Graph2d.itemsData.add(newData);
                i++;
            };

            $.connection.hub.start().done(function () {
                //alert('initializing server');
                chart.server.start('@Server.UrlEncode(Model.Servername)', '@Server.UrlEncode(Model.DbName)', '@Model.Preferences.NumberOfPoints', '@Model.Preferences.PollingFrequency');
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
</script>

    @Scripts.Render("~/bundles/jqueryval")
}
